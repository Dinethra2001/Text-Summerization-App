<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input History</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='history.css') }}"
    />
  </head>
  <body>
    <!-- Display the username in the top right corner -->
    <div style="text-align: right">
      <h3>Welcome ! {{ username }}</h3>
    </div>

    <h1>Your History</h1>
    <div id="input-history">
      <table>
        <thead>
          <tr>
            <th>Input Text / Link</th>
            <th>Summary</th>
            <th>Sentiment</th>
            <th>Keywords</th>
            <th>Topics</th>
          </tr>
        </thead>
        <tbody id="history-body">
          <!-- History will be populated here -->
        </tbody>
      </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
      $(document).ready(function () {
        // Fetch user inputs when the document is ready
        $.ajax({
          url: "/get_user_inputs",
          type: "GET",
          success: function (response) {
            const inputs = response.inputs;
            if (inputs.length > 0) {
              $("#history-body").empty(); // Clear the table body

              inputs.forEach(function (input) {
                // Format the keywords and topics into list items
                const keywordsList = input.keywords
                  .map((keyword) => `<li>${keyword}</li>`)
                  .join("");
                const topicsList = input.topics
                  .map((topic) => `<li>${topic}</li>`)
                  .join("");

                const row = `
                            <tr>
                                <td>${input.input}</td>
                                <td>${input.summary}</td>
                                <td>${input.sentiment}</td>
                                <td><ul>${keywordsList}</ul></td> <!-- Keywords as list items -->
                                <td><ul>${topicsList}</ul></td>   <!-- Topics as list items -->
                            </tr>`;
                $("#history-body").append(row);
              });
            } else {
              $("#history-body").html(
                '<tr><td colspan="5">No history found.</td></tr>'
              );
            }
          },
          error: function (xhr, status, error) {
            console.error("An error occurred: " + error);
            $("#history-body").html(
              '<tr><td colspan="5">An error occurred while fetching inputs.</td></tr>'
            );
          },
        });
      });
    </script>

    <style>
      /* Style for the overall table */
      table {
        width: 100%;
        border-collapse: collapse;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        border: 5px solid #ddd; /* Border around the entire table */
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        font-family: Arial, sans-serif;
        border: 1px solid #ddd; /* Border around each cell */
      }

      th {
        background-color: #b3e0ff; /* Light blue */
        color: blue; /* Change the text color of the column names to blue */
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      tr:hover {
        background-color: #f1f1f1;
      }

      /* Style for the unordered list inside the table */
      ul {
        list-style-type: disc; /* Display bullet points */
        padding-left: 20px; /* Adjust padding if necessary */
        margin: 0;
      }

      li {
        padding-left: 5px;
      }

      /* Change the color of the bullets */
      li::marker {
        color: blue; /* Change to the color you want for the bullets */
      }

      #input-history {
        margin-top: 30px;
      }

      /* Responsive design for smaller screens */
      @media (max-width: 768px) {
        table {
          font-size: 14px;
        }
        th,
        td {
          padding: 10px;
        }
      }
    </style>
  </body>
</html>
